<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پنل مدیریت ربات تلگرام | نسخه دائمی</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Vazirmatn', sans-serif; background-color: #f8fafc; }
        .ltr { direction: ltr; }
        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect, useRef } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';

        const App = () => {
            const [token, setToken] = useState(localStorage.getItem('bot_token') || '');
            const [commands, setCommands] = useState(JSON.parse(localStorage.getItem('bot_commands')) || [
                { id: 1, cmd: '/start', response: 'سلام! این ربات ۲۴ ساعته فعال است.' }
            ]);
            const [webhookUrl, setWebhookUrl] = useState(localStorage.getItem('webhook_url') || '');
            const [status, setStatus] = useState('offline');
            const [logs, setLogs] = useState([]);
            const [newCmd, setNewCmd] = useState({ cmd: '', response: '' });

            useEffect(() => {
                localStorage.setItem('bot_token', token);
                localStorage.setItem('bot_commands', JSON.stringify(commands));
                localStorage.setItem('webhook_url', webhookUrl);
            }, [token, commands, webhookUrl]);

            const addLog = (msg) => {
                const time = new Date().toLocaleTimeString('fa-IR');
                setLogs(prev => [`[${time}] ${msg}`, ...prev].slice(0, 20));
            };

            // متد فعال‌سازی Webhook (برای کارکرد دائمی)
            const setupWebhook = async () => {
                if (!token || !webhookUrl) return alert("توکن و آدرس API ورسل را وارد کنید");
                
                addLog("در حال تنظیم Webhook برای کارکرد دائمی...");
                try {
                    const res = await fetch(`https://api.telegram.org/bot${token}/setWebhook?url=${webhookUrl}`);
                    const data = await res.json();
                    if (data.ok) {
                        addLog("✅ وب‌هوک با موفقیت ست شد. ربات حالا ۲۴ ساعته پاسخ می‌دهد.");
                        setStatus('webhook_active');
                    } else {
                        addLog("❌ خطا در تنظیم وب‌هوک: " + data.description);
                    }
                } catch (e) {
                    addLog("❌ خطا در برقراری ارتباط.");
                }
            };

            const deleteWebhook = async () => {
                await fetch(`https://api.telegram.org/bot${token}/deleteWebhook`);
                addLog("وب‌هوک حذف شد. ربات به حالت دستی برگشت.");
                setStatus('offline');
            };

            return React.createElement('div', { className: 'max-w-6xl mx-auto p-4 md:p-8' }, [
                // Header
                React.createElement('header', { className: 'flex justify-between items-center mb-8 bg-white p-6 rounded-2xl shadow-sm border' }, [
                    React.createElement('div', { className: 'flex items-center gap-3' }, [
                        React.createElement('div', { className: 'bg-indigo-600 p-2.5 rounded-xl text-white' }, React.createElement('i', { 'data-lucide': 'globe' })),
                        React.createElement('h1', { className: 'text-2xl font-black text-slate-800' }, 'پنل ربات دائمی (Vercel Cloud)')
                    ]),
                    React.createElement('div', { className: 'text-sm font-bold ' + (status === 'webhook_active' ? 'text-green-600' : 'text-slate-400') }, 
                        status === 'webhook_active' ? '● وضعیت: فعال ابری (۲۴ ساعته)' : '○ وضعیت: آفلاین'
                    )
                ]),

                React.createElement('div', { className: 'grid grid-cols-1 lg:grid-cols-3 gap-8' }, [
                    // Right Col
                    React.createElement('div', { className: 'space-y-6' }, [
                        // Webhook Setup
                        React.createElement('div', { className: 'bg-white p-6 rounded-2xl border shadow-sm' }, [
                            React.createElement('h3', { className: 'font-bold mb-4 flex items-center gap-2' }, 'تنظیمات سرور همیشگی'),
                            React.createElement('p', { className: 'text-xs text-slate-500 mb-4' }, 'آدرس Endpoint ورسل خود را در اینجا وارد کنید تا ربات ۲۴ ساعته شود.'),
                            React.createElement('input', { 
                                placeholder: 'توکن ربات',
                                className: 'w-full p-3 bg-slate-50 border rounded-xl ltr text-left mb-3 outline-none focus:ring-2 focus:ring-indigo-500',
                                value: token,
                                onChange: e => setToken(e.target.value)
                            }),
                            React.createElement('input', { 
                                placeholder: 'https://your-app.vercel.app/api/bot',
                                className: 'w-full p-3 bg-slate-50 border rounded-xl ltr text-left mb-4 outline-none focus:ring-2 focus:ring-indigo-500',
                                value: webhookUrl,
                                onChange: e => setWebhookUrl(e.target.value)
                            }),
                            status !== 'webhook_active' ? 
                            React.createElement('button', { onClick: setupWebhook, className: 'w-full bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700' }, 'فعال‌سازی حالت ابری') :
                            React.createElement('button', { onClick: deleteWebhook, className: 'w-full bg-red-50 text-red-600 py-3 rounded-xl font-bold border border-red-100' }, 'غیرفعال‌سازی')
                        ]),

                        // Logs
                        React.createElement('div', { className: 'bg-slate-900 rounded-2xl p-5' }, [
                            React.createElement('h3', { className: 'text-slate-400 text-[10px] mb-3 uppercase' }, 'وضعیت سیستم'),
                            React.createElement('div', { className: 'space-y-2 font-mono text-[11px] h-40 overflow-y-auto ltr text-left custom-scrollbar text-indigo-400' }, 
                                logs.map((log, i) => React.createElement('div', { key: i }, log))
                            )
                        ])
                    ]),

                    // Left Col
                    React.createElement('div', { className: 'lg:col-span-2 space-y-6' }, [
                        React.createElement('div', { className: 'bg-white p-6 rounded-2xl border shadow-sm' }, [
                            React.createElement('h3', { className: 'font-bold mb-4' }, 'تعریف دستورات ربات'),
                            React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-3 mb-4' }, [
                                React.createElement('input', { 
                                    placeholder: 'دستور (مثلاً /price)',
                                    className: 'p-3 bg-slate-50 border rounded-xl ltr outline-none',
                                    value: newCmd.cmd,
                                    onChange: e => setNewCmd({...newCmd, cmd: e.target.value})
                                }),
                                React.createElement('input', { 
                                    placeholder: 'پاسخ ربات...',
                                    className: 'p-3 bg-slate-50 border rounded-xl outline-none',
                                    value: newCmd.response,
                                    onChange: e => setNewCmd({...newCmd, response: e.target.value})
                                })
                            ]),
                            React.createElement('button', { 
                                onClick: () => {
                                    if(newCmd.cmd && newCmd.response) {
                                        setCommands([{ ...newCmd, id: Date.now() }, ...commands]);
                                        setNewCmd({ cmd: '', response: '' });
                                    }
                                },
                                className: 'w-full bg-slate-800 text-white py-3 rounded-xl font-bold'
                            }, 'ثبت دستور جدید')
                        ]),

                        React.createElement('div', { className: 'space-y-3' }, 
                            commands.map(c => React.createElement('div', { key: c.id, className: 'bg-white p-4 rounded-xl border flex justify-between items-center shadow-sm' }, [
                                React.createElement('div', null, [
                                    React.createElement('span', { className: 'font-mono text-indigo-600 font-bold ml-4' }, c.cmd),
                                    React.createElement('span', { className: 'text-slate-600 text-sm' }, c.response)
                                ]),
                                React.createElement('button', { onClick: () => setCommands(commands.filter(x => x.id !== c.id)), className: 'text-slate-300 hover:text-red-500' }, React.createElement('i', { 'data-lucide': 'trash-2', size: 18 }))
                            ]))
                        )
                    ])
                ])
            ]);
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
        setTimeout(() => lucide.createIcons(), 500);
    </script>
</body>
</html>
