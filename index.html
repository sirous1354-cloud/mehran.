<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>پنل هوشمند ربات‌ساز تلگرام</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@100;400;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Vazirmatn', sans-serif; background-color: #f0f2f5; }
        .ltr { direction: ltr; }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 10px; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import React, { useState, useEffect } from 'https://esm.sh/react@18.2.0';
        import ReactDOM from 'https://esm.sh/react-dom@18.2.0/client';

        const App = () => {
            const [token, setToken] = useState('');
            const [botInfo, setBotInfo] = useState(null);
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [status, setStatus] = useState('offline');
            const [commands, setCommands] = useState([
                { id: 1, cmd: '/start', response: 'سلام! ربات شما با موفقیت فعال شد.' },
                { id: 2, cmd: '/help', response: 'من یک ربات هوشمند هستم که توسط پنل شما مدیریت می‌شوم.' }
            ]);
            const [newCmd, setNewCmd] = useState({ cmd: '', response: '' });
            const [logs, setLogs] = useState([]);

            const addLog = (msg) => {
                const time = new Date().toLocaleTimeString('fa-IR');
                setLogs(prev => [`[${time}] ${msg}`, ...prev].slice(0, 15));
            };

            const startBot = async () => {
                if (!token) {
                    setError('لطفاً ابتدا توکن ربات را وارد کنید');
                    return;
                }
                setLoading(true);
                setError('');
                setStatus('connecting');
                addLog('در حال تلاش برای اتصال به سرورهای تلگرام...');

                try {
                    const response = await fetch(`https://api.telegram.org/bot${token}/getMe`);
                    const data = await response.json();
                    
                    if (data.ok) {
                        setBotInfo(data.result);
                        setStatus('online');
                        addLog(`اتصال برقرار شد: @${data.result.username} آنلاین است.`);
                    } else {
                        setStatus('offline');
                        setError('توکن اشتباه است یا دسترسی به تلگرام محدود شده است.');
                        addLog('خطا: توکن نامعتبر.');
                    }
                } catch (err) {
                    setStatus('offline');
                    setError('خطا در شبکه! مطمئن شوید فیلترشکن شما روشن است.');
                    addLog('خطا در برقراری ارتباط با API.');
                } finally {
                    setLoading(false);
                }
            };

            const stopBot = () => {
                setStatus('offline');
                setBotInfo(null);
                addLog('ربات خاموش شد.');
            };

            const addCommand = () => {
                if (newCmd.cmd && newCmd.response) {
                    const formattedCmd = newCmd.cmd.startsWith('/') ? newCmd.cmd : `/${newCmd.cmd}`;
                    setCommands([...commands, { ...newCmd, cmd: formattedCmd, id: Date.now() }]);
                    setNewCmd({ cmd: '', response: '' });
                    addLog(`دستور جدید اضافه شد: ${formattedCmd}`);
                }
            };

            const deleteCommand = (id) => {
                const target = commands.find(c => c.id === id);
                setCommands(commands.filter(c => c.id !== id));
                addLog(`دستور حذف شد: ${target?.cmd}`);
            };

            return React.createElement('div', { className: 'min-h-screen' }, [
                // Navbar
                React.createElement('nav', { className: 'bg-white border-b border-slate-200 px-6 py-4 sticky top-0 z-50 shadow-sm' }, 
                    React.createElement('div', { className: 'max-w-6xl mx-auto flex justify-between items-center' }, [
                        React.createElement('div', { className: 'flex items-center gap-3' }, [
                            React.createElement('div', { className: 'bg-blue-600 p-2 rounded-lg text-white' }, React.createElement('i', { 'data-lucide': 'bot' })),
                            React.createElement('h1', { className: 'text-xl font-black text-slate-800' }, 'پنل هوشمند ربات‌ساز')
                        ]),
                        React.createElement('div', { className: 'flex items-center gap-4' }, 
                            status === 'online' ? 
                            React.createElement('div', { className: 'flex items-center gap-2 bg-green-50 text-green-700 px-3 py-1.5 rounded-full text-sm font-bold border border-green-200' }, [
                                React.createElement('span', { className: 'w-2 h-2 bg-green-500 rounded-full animate-ping' }),
                                'وضعیت: آنلاین'
                            ]) : 
                            React.createElement('div', { className: 'flex items-center gap-2 bg-slate-100 text-slate-500 px-3 py-1.5 rounded-full text-sm font-bold' }, 'وضعیت: آفلاین')
                        )
                    ])
                ),

                // Main Content
                React.createElement('main', { className: 'max-w-6xl mx-auto p-6 grid grid-cols-1 lg:grid-cols-3 gap-6' }, [
                    // Sidebar
                    React.createElement('div', { className: 'space-y-6' }, [
                        React.createElement('div', { className: 'bg-white rounded-2xl shadow-sm p-6 border border-slate-200' }, [
                            React.createElement('h3', { className: 'font-bold text-slate-800 mb-4 flex items-center gap-2' }, 'تنظیمات توکن'),
                            React.createElement('input', { 
                                className: 'w-full p-3 bg-slate-50 border border-slate-200 rounded-xl ltr text-left focus:ring-2 focus:ring-blue-500 outline-none mb-4',
                                placeholder: '123456789:ABC...',
                                value: token,
                                onChange: (e) => setToken(e.target.value),
                                disabled: status === 'online'
                            }),
                            status === 'offline' ? 
                            React.createElement('button', { 
                                onClick: startBot, 
                                disabled: loading,
                                className: 'w-full bg-blue-600 text-white py-3 rounded-xl font-bold transition-all hover:bg-blue-700 disabled:opacity-50' 
                            }, loading ? 'در حال اتصال...' : 'فعال‌سازی ربات') :
                            React.createElement('button', { 
                                onClick: stopBot,
                                className: 'w-full bg-red-50 text-red-600 py-3 rounded-xl font-bold border border-red-200 hover:bg-red-100' 
                            }, 'متوقف کردن')
                        ]),
                        React.createElement('div', { className: 'bg-slate-900 rounded-2xl p-6 text-slate-300' }, [
                            React.createElement('h3', { className: 'font-bold text-white mb-4 text-sm' }, 'گزارشات زنده'),
                            React.createElement('div', { className: 'space-y-2 font-mono text-[10px] h-40 overflow-y-auto ltr text-left custom-scrollbar' }, 
                                logs.length > 0 ? logs.map((log, i) => React.createElement('div', { key: i, className: 'border-b border-slate-800 pb-1 text-slate-400' }, log)) : 'در انتظار فعالیت...'
                            )
                        ])
                    ]),

                    // Dashboard
                    React.createElement('div', { className: 'lg:col-span-2 space-y-6' }, [
                        // Stats
                        React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-3 gap-4' }, [
                            ['دستورات', commands.length, 'message-square'],
                            ['کاربران', status === 'online' ? '۱۲' : '۰', 'users'],
                            ['سرور', status === 'online' ? '۰.۲٪' : '۰٪', 'cpu']
                        ].map(([label, val, icon]) => 
                            React.createElement('div', { key: label, className: 'bg-white p-4 rounded-2xl border border-slate-200 flex items-center gap-4' }, [
                                React.createElement('div', { className: 'bg-blue-50 p-3 rounded-xl text-blue-600' }, React.createElement('i', { 'data-lucide': icon })),
                                React.createElement('div', null, [
                                    React.createElement('div', { className: 'text-xs text-slate-500' }, label),
                                    React.createElement('div', { className: 'text-xl font-black' }, val)
                                ])
                            ])
                        )),

                        // Manager
                        React.createElement('div', { className: 'bg-white rounded-2xl border border-slate-200 overflow-hidden' }, [
                            React.createElement('div', { className: 'p-6 border-b border-slate-100 font-bold' }, 'مدیریت پاسخ‌های خودکار'),
                            React.createElement('div', { className: 'p-6 space-y-6' }, [
                                React.createElement('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' }, [
                                    React.createElement('input', { 
                                        placeholder: 'دستور (مثلاً /start)',
                                        className: 'p-2.5 bg-slate-50 border rounded-lg ltr outline-none',
                                        value: newCmd.cmd,
                                        onChange: e => setNewCmd({...newCmd, cmd: e.target.value})
                                    }),
                                    React.createElement('input', { 
                                        placeholder: 'پاسخ ربات...',
                                        className: 'p-2.5 bg-slate-50 border rounded-lg outline-none',
                                        value: newCmd.response,
                                        onChange: e => setNewCmd({...newCmd, response: e.target.value})
                                    }),
                                    React.createElement('button', { 
                                        onClick: addCommand,
                                        className: 'md:col-span-2 bg-slate-800 text-white py-2.5 rounded-lg font-bold hover:bg-slate-900 transition-all'
                                    }, 'اضافه کردن به دیتابیس')
                                ]),
                                React.createElement('div', { className: 'space-y-3' }, 
                                    commands.map(c => React.createElement('div', { key: c.id, className: 'flex items-center justify-between p-4 bg-slate-50 rounded-xl border border-slate-100' }, [
                                        React.createElement('div', { className: 'flex items-center gap-4' }, [
                                            React.createElement('div', { className: 'bg-white px-3 py-1 rounded shadow-sm font-mono text-blue-600 text-sm font-bold ltr' }, c.cmd),
                                            React.createElement('div', { className: 'text-slate-600 text-sm' }, c.response)
                                        ]),
                                        React.createElement('button', { onClick: () => deleteCommand(c.id), className: 'text-slate-300 hover:text-red-500' }, React.createElement('i', { 'data-lucide': 'trash-2', size: 18 }))
                                    ]))
                                )
                            ])
                        ])
                    ])
                ])
            ]);
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(React.createElement(App));
        
        // Initialize Icons
        setTimeout(() => lucide.createIcons(), 500);
    </script>
</body>
</html>
